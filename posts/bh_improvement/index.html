<!doctype html><html lang=ru dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Немного про построение векторов атак | Ardent101</title><meta name=keywords content="Active Directory,Pentest,Теория"><meta name=description content="Введение Как правило, домен на базе Active Directory обладает значительным количеством объектов, свойств и связей между ними. В общем случае «вручную» выявить недостатки в настройке домена и на их основе построить вероятный вектор атаки является довольно трудоемкой задачей и справится с ней без вспомогательных программных средств не представляется возможным.
В настоящем материале будет представлен обзор некоторых программных средств, использующихся для автоматизированного построения вероятных атак в домене. Кроме того, будут рассмотрены некоторые подходы к улучшению уже имеющихся решений, а также предложен собственный алгоритм к выявлению наиболее приоритетных целей атак."><meta name=author content="Ardent101"><link rel=canonical href=https://ardent101.github.io/posts/bh_improvement/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d6ed90c28450051e5bafcc0bf4bfe033ff2b04454909211dc9e97b8a50525621.css integrity="sha256-1u2QwoRQBR5br8wL9L/gM/8rBEVJCSEdyel7ilBSViE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ardent101.github.io/static/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ardent101.github.io/static/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ardent101.github.io/static/favicon-32x32.png><link rel=apple-touch-icon href=https://ardent101.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://ardent101.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Немного про построение векторов атак"><meta property="og:description" content="Введение Как правило, домен на базе Active Directory обладает значительным количеством объектов, свойств и связей между ними. В общем случае «вручную» выявить недостатки в настройке домена и на их основе построить вероятный вектор атаки является довольно трудоемкой задачей и справится с ней без вспомогательных программных средств не представляется возможным.
В настоящем материале будет представлен обзор некоторых программных средств, использующихся для автоматизированного построения вероятных атак в домене. Кроме того, будут рассмотрены некоторые подходы к улучшению уже имеющихся решений, а также предложен собственный алгоритм к выявлению наиболее приоритетных целей атак."><meta property="og:type" content="article"><meta property="og:url" content="https://ardent101.github.io/posts/bh_improvement/"><meta property="og:image" content="https://ardent101.github.io/posts/bh_improvement/images/logo_final.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-28T08:31:03+00:00"><meta property="article:modified_time" content="2023-05-28T08:31:03+00:00"><meta property="og:site_name" content="Ardent101"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ardent101.github.io/posts/bh_improvement/images/logo_final.jpg"><meta name=twitter:title content="Немного про построение векторов атак"><meta name=twitter:description content="Введение Как правило, домен на базе Active Directory обладает значительным количеством объектов, свойств и связей между ними. В общем случае «вручную» выявить недостатки в настройке домена и на их основе построить вероятный вектор атаки является довольно трудоемкой задачей и справится с ней без вспомогательных программных средств не представляется возможным.
В настоящем материале будет представлен обзор некоторых программных средств, использующихся для автоматизированного построения вероятных атак в домене. Кроме того, будут рассмотрены некоторые подходы к улучшению уже имеющихся решений, а также предложен собственный алгоритм к выявлению наиболее приоритетных целей атак."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ardent101.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Немного про построение векторов атак","item":"https://ardent101.github.io/posts/bh_improvement/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Немного про построение векторов атак","name":"Немного про построение векторов атак","description":"Введение Как правило, домен на базе Active Directory обладает значительным количеством объектов, свойств и связей между ними. В общем случае «вручную» выявить недостатки в настройке домена и на их основе построить вероятный вектор атаки является довольно трудоемкой задачей и справится с ней без вспомогательных программных средств не представляется возможным.\nВ настоящем материале будет представлен обзор некоторых программных средств, использующихся для автоматизированного построения вероятных атак в домене. Кроме того, будут рассмотрены некоторые подходы к улучшению уже имеющихся решений, а также предложен собственный алгоритм к выявлению наиболее приоритетных целей атак.","keywords":["Active Directory","Pentest","Теория"],"articleBody":"Введение Как правило, домен на базе Active Directory обладает значительным количеством объектов, свойств и связей между ними. В общем случае «вручную» выявить недостатки в настройке домена и на их основе построить вероятный вектор атаки является довольно трудоемкой задачей и справится с ней без вспомогательных программных средств не представляется возможным.\nВ настоящем материале будет представлен обзор некоторых программных средств, использующихся для автоматизированного построения вероятных атак в домене. Кроме того, будут рассмотрены некоторые подходы к улучшению уже имеющихся решений, а также предложен собственный алгоритм к выявлению наиболее приоритетных целей атак.\nВажно отметить, что материал рассчитан на читателя, обладающего опытом по тестированию на проникновение Active Directory.\nИмеющиеся решения На момент написания статьи в общем доступе имеется множество инструментов по анализу недостатков настроек Active Directory. Например:\n Bloodhound Jackdaw Adalanche Pingcastle Purple Knight StandIn zBang ADRecon AD-control-paths AttackSurfaceAnalyzer  Если грубо, то принцип работы инструментов заключается в сборе информации об исследуемом домене по протоколу LDAP. Как правило инструменты содержат ряд типовых запросов, проверяющих наличие определенного недостатка или небезопасной настройки. В дальнейшем, полученные ответы представляются для анализа специалисту.\nСобранные результаты могут быть представлены в интерактивном виде (BloodHound, Adalanche, Jackdaw). В этом случае инструмент обладает графической оболочкой к некоторой базе данных с возможностью выполнения уточняющих запросов со стороны специалиста.\nДругим способом представления результатов является статический сгенерированный отчет (PingCastle, Purple Knight).\nСуществует небезосновательное мнение, что защищающиеся мыслят списками, а атакующие мыслят графами, и пока так – последние будут побеждать.\nПоэтому особой популярностью пользуются именно интерактивные инструменты, отображающие результат запросов в виде графа. На практике одним из наиболее удобных и полезных из интерактивных инструментов считается BloodHound. К его преимуществам можно отнести наличие активного сообщества пользователей, возможность расширения функционала, а также удобный интерфейс. Фактически без BloodHound не обходится ни одно тестирование на проникновение домена на базе Active Directory. Именно поэтому далее основное внимание будет уделено этому средству.\nТем не менее некоторые из других представленных инструментов также заслуживают внимания. Особенно актуально использование альтернативных средств с точки зрения перекрестной проверки получаемых результатов.\nРазумеется самым лучшим способом для оценки инструмента является “метод мачете”, то есть просто начать пользоваться, пусть даже по началу и не особо вдаваясь в детали. Рекомендую попробовать применить указанный метод к Jackdaw и Adalanche.\n\r\r\rПример интерфейса Jackdaw\r\r\r\r\r\rПример интерфейса Adalanche\r\r\rЧасть 1. Улучшения Bloodhound Далее рассмотрим некоторые способы расширения возможностей BloodHound.\nПользовательские хранимые запросы BloodHound представляет графическую оболочку для работы с базой данных Neo4j. Запросы к базе Neo4j бывают:\n “графовые” - результат представляет граф, который может быть отображен в приложении BloodHound. “консольные” - результат представляет таблицу со строками, которую можно посмотреть в Neo4j Browser. В интерфейсе BloodHound работать с указанными запросами нельзя.  BloodHound позволяет специалисту добавить в интерфейс собственные наиболее часто используемые графовые запросы. Для этого необходимо сохранить указанные запросы в предопределенном формате в файл customqueries.json.\nВ Windows данный файл хранится по следующему пути:\nC:\\Users[USERNAME]\\AppData\\Roaming\\BloodHound\\customqueries.json В Linux:\n~/.config/bloodhound/customqueries.json Посмотреть примеры дополнительных пользовательских запросов, а также ознакомиться со структурой файла customqueries.json, можно в следующих источниках:\n Официальная документация Neo4j по Cypher Bloodhound: Intro To Cypher - более подробно о языке запросов BloodHound Cypher Cheatsheet- строковые и графовые запросы mgeeky - множество группированных запросов  Добавление новых сущностей По умолчанию в BloodHound обрабатывается информация, добытая с помощью штатного сборщика - SharpHound. Тем не менее архитектура программы позволяет добавлять новые сущности: объекты, атрибуты объектов, а также связи.\nПрежде чем выявлять какие-либо векторы атак целесообразно максимально наполнить пространство возможных вариантов, то есть собрать и загрузить в BloodHound как можно больше информации.\nCertipy Рассмотрим один из актуальных примеров добавления новых сущностей в BloodHound.\nЛетом 2021 года была опубликована знаковая статья “Certified Pre-Owned:\nAbusing Active Directory Certificate Services”. В результате публикации арсенал специалистов по тестированию на проникновение обогатился множеством новых методов атак, связанных с эксплуатацией небезопасных настроек центров сертификации.\nСо временем появились программные средства, автоматизирующие поиск и эксплуатацию уязвимых настроек. Одно из указанных средств под названием Certipy имеет модуль сбора информации, обладающий возможностью интеграции с BloodHound.\nВ итоге в BloodHound могут быть дополнительно загружены следующие данные:\n настройки центров сертификаций шаблоны для выпуска сертификатов  Также с помощью Certipy в BloodHound добавляются новые связи (“enroll”, “ManageCA” и т.д.) между стандартными и новыми объектами.\nБолее того, автор Certipy также создал собственную версию BloodHound, чтобы красиво отображать новые сущности, то есть отрисовать их иконки и вкладку со свойствами, появляющуюся при выделении объекта.\n\r\r\rПример отображения новых объектов в версии BloodHound от создателя Certipy\r\r\r\r\r\rПример содержимого во вкладке центра сертификации\r\r\r\r\r\rПример отображения прав на выпуск сертификата\r\r\rКроме того, для удобной работы с полученными данными в Certipy предусмотрен перечень типовых запросов к BloodHound.\n\r\r\rПример новых запросов с учетом шаблонов для выдачи сертификатов\r\r\rВажно отметить, что при всем своем великолепии Certipy иногда предоставляет неверную информацию. Это связано с некорректной проверкой прав доступа к шаблонам сертификатов. В этом плане лучше ориентироваться на PingCastle, в котором анализ настроек производится корректно.\nИспользуемые источники:\n Certipy 2.0: BloodHound, New Escalations, Shadow Credentials, Golden Certificates, and more! Certipy 4.0: ESC9 \u0026 ESC10, BloodHound GUI, New Authentication and Request Methods — and more!  Ручное добавление Из рассмотренного ранее примера, видно что в BloodHound возможно самостоятельно добавить поддержку абсолютно новых сущностей.\nПолный разбор добавления новых сущностей выходит за рамки настоящего материала. Тем не менее, для более опытных читателей обозначу направление, позволяющее разобраться в указанном вопросе.\nРекомендую взять две следующие версии BloodHound:\n официальная 4.2.0 модернизированная для Certipy 4.2.0  Далее с помощью WInMerge требуется сравнить указанные версии между собой. В результате сравнения будет видно, где и как требуется подправить код программы. Остается всего-то по аналогии внести необходимые изменения и заново скомпилировать программу.\nВ целом базовых знаний в программировании достаточно, чтобы разобраться как добавить абсолютно новый объект в BloodHound.\nПрикладной и сетевой уровни Продолжим рассматривать идеи для обогащения BloodHound новыми сущностями.\nПрежде всего стоит отметить, что BloodHound работает с информацией “административного” уровня, то есть с атрибутами объектов домена. Тем не менее можно добавить другие уровни: “прикладной” и “сетевой”.\n\r“Прикладной” уровень содержит информацию об используемом программном обеспечении. По сути добавление объектов на прикладном уровне сводится к инструментальному сканированию на предмет наличия критических уязвимостей.\nДопустим один из серверов домена подвержен MS17-10. В этом случае имеет смысл отметить указанный сервер, как захваченный и дальнейшее построение векторов атак проводить с учетом новой начальной точки.\nТакже на прикладном уровне возможно выделять веб-приложения для последующего поиска уязвимостей или перебора учетных записей. Осуществить указанный поиск возможно с помощью Witness-подобных инструментов, например GoWitness.\nНа “сетевом” уровне следует оценивать доступность объекта с точки зрения правил разграничения сетевого доступа. Проверить доступность можно следующими двумя способами:\n проанализировав настройки правил в конфигурационных файлах телекоммуникационного оборудования выполнив сканирование  В плане сетевого сканирования особо интересен инструмент cornershot. Одной из отличительных черт указанного инструмента является возможность проверки сетевой доступности узла Б со стороны узла Ц, находясь на узле А.\nТаким образом, в результате анализа “сетевого” уровня можно уменьшить количество ложных векторов, например:\n присутствует ребро “CanRDP”, но по факту по RDP подключиться нельзя присутствует критическая уязвимость, но отсутствует сетевой доступ к службе, необходимой для эксплуатации уязвимости  Попытка реализовать рассмотренные подходы предпринималась в инструментах BlueHound, ShotHound.\n\r\r\rПример интерфейса BlueHound\r\r\rТакже возможно поискать системы с несколькими сетевыми интерфейсами:\n IOXIDResolver SharpOxidResolver Nextnet  С помощью приведенных инструментов можно выявить сетевой доступ в сторонние подсети, например технологические.\nПривилегии Тот факт, что Sharphound собирает множество информации из групповых политик домена, не означает, что больше ничего интересного в них найти не получится.\nВ 2020 году Riccardo Ancarani написал замечательную статью Extending BloodHound Part 1 - GPOs and User Right Assignment , в которой рассказывается, как дополнить BloodHound информацией о наличии критичных привилегий у пользователей домена.\nДело в том, что групповые политики могут использоваться для назначения привилегий, в том числе “опасных”, например:\n SeAssignPrimaryToken SeBackupPrivilege SeCreateTokenPrivilege SeDebugPrivilege SeImpersonatePrivilege SeLoadDriverPrivilege SeRestorePrivilege SeTakeOwnershipPrivilege SeTcbPrivilege  Обладание любой из указанных привилегий позволяет пользователю успешно локально повысить свои права до уровня системы. Более подробно об эксплуатации указанных привилегий можно посмотреть в докладе “Show me your privileges and I will lead you to SYSTEM”\nВ BloodHound получившийся граф атаки выглядит следующим образом:\n\rКроме того, важно выделить привилегию SeEnableDelegationPrivilege, которая позволяет скомпрометировать не отдельную систему, а домен целиком.\nCписки контроля доступа Вопрос улучшения Bloodhound интересует и других отечественных исследователей. Не так давно Дмитрий Неверов опубликовал три статьи на эту тему.\nВ одной из статей “Расширение списка ACE для BloodHound” показывается, как добавить в BloodHound следующие новые ребра:\n WriteGPLink WriteGPOptions WriteSAMAccountName WriteUserAccountControl WriteTSInitialProgram WriteScriptPath  \rРекомендую ознакомиться со статьями Дмитрия целиком. Cреди прочего в его материалах раскрыт технический процесс внедрения новых сущностей в BloodHound.\nОтмечу, что список рассмотренных в статье прав, можно дополнить расширенным правом DS-Validated-Write-Computer, позволяющим проводить атаку ShadowCredentials.\nЛокальные администраторы В другой статье BloodHound: групповые политики и локальный администратор Дмитрий Неверов показывает, как и откуда добавить в BloodHound учетные записи локальных администраторов.\n\rОт себя могу заметить, что учетные записи локальных администраторов также могут быть подобраны перебором или извлечены из SYSVOL.\nАутентификационные данные В качестве аутентификационных данных можно рассматривать связку названия домена, идентификатора учетной записи и либо пароля в открытом виде, либо NT-хеша пароля.\nАнализ паролей и NT-хешей полезен при выборе наиболее подходящих целей для атак методом распыления паролей. Автоматизация указанной идеи описана в статье Неверова “BloodHound и результаты атаки PasswordSpray”.\nТакже выявление одинаковых паролей рассматривается в статьях:\n Representing Password Reuse in BloodHound Case Study: Password Analysis with BloodHound Expanding the Hound: Introducing Plaintext Field to Compromised Accounts  В последней статье для загрузки паролей предлагается использовать утилиту CrackHound. Альтернативная утилита - add-spw из Max.\n\r\rКроме того, анализ аутентификационных данных можно проводить на предмет выявления разных учетных записей, принадлежащих одному и тому же пользователю. Подробнее почитать об этом можно в статье: Exploring Users With Multiple Accounts In BloodHound.\n\rВ рассмотренных примерах авторы оперируют паролями или их NT-хешами, но можно пойти еще дальше и добавить NTLM v1 хеши.\nПолучение NTLM v1 хеша пароля к некоторой учетной записи равноценно получению доступа к указанной учетной записи ввиду возможности проведения атаки методом полного перебора за приемлемое время на соответствующем оборудовании (до 2 суток на ферме из 8 RTX 2080).\nРазбор атак на NTLM v1 выходит за рамки настоящего материала. Отмечу, что в ряде случаев, когда не получается использовать радужные таблицы, важным становится вопрос выделения наиболее приоритетных хешей для брута. Именно тогда может пригодиться расширение объектов BloodHound новым атрибутом, отображающим наличие NTLM v1 хеша.\nПользовательские сервисные учетные записи Еще один примитив, который может быть добавлен в BloodHound - ребро, свидетельствующее об использовании пользовательской учетной записи в качестве сервисной на определенной системе. По словам автора в 2/3 случаев удается получить пароль в открытом виде к указанной учетной записи из хранилища секретов LSA.\n\rДля создания указанного ребра можно использовать утилиту add-spns из Max.\nВесовые коэффициенты Рассмотрим следующие два результата запроса на поиск кратчайшего пути к администраторам домена:\n\r\r\rПервый путь\r\r\r\r\r\rВторой путь\r\r\rС точки зрения BloodHound второй путь выглядит более предпочтительным, так как он короче чем первый. На практике наоборот, первый путь представляет последовательность вложенных групп, то есть фактически никаких усилий для доступа к группе “Domain Admins” предпринимать не надо. Во втором пути требуется выполнения дополнительных условий, в частности “User B” после входа по RDP должен каким-то образом повысить свои права на “CALABDC.HACKERS.LAB”.\nПриведенный пример хорошо иллюстрирует следующую мысль: “разные ребра графа обладают разными характеристиками, которые никак не учитываются в BloodHound”.\nВ качестве характеристик можно рассматривать следующие параметры:\n сложность перехода по ребру с точки зрения реализации на практике скрытность эксплуатации  Определившись с категориями характеристик, специалист должен вручную задать весовые параметры для каждого из возможных ребер графа. По итогу получается подобная таблица:\n\rЧем хуже проявляется свойство, тем выше вес. Сразу отмечу, что задача распределения весов сводится к экспертной оценке специалиста.\nПосле распределения весов для дальнейшей работы необходимо составить соответствующие запросы. По умолчанию BloodHound не учитывает вес при поиске кратчайших путей. Для использования в Neo4j алгоритмов поиска наименьших расстояний во взвешенном графе следует подключить библиотеку Graph Data Science.\nБолее подробно вопрос внедрения весовых коэффициентов описывается в статье Not All Paths are Created Equal.\nМногоуровневая архитектура безопасности Более подробно ознакомиться с понятием многоуровневой архитектуры безопасности можно по следующим ссылкам:\n Запись трансляции в формате тестового собеседования Mitigate Credential theft with Administrative Tier Model - копия статьи из официальной документации Microsoft  Применительно к BloodHound существует инструмент ImproHound, с помощью которого возможно распределить все объекты домена между тремя уровнями.\n\rПо окончанию распределения инструмент осуществляет поиск путей между объектами низлежащих уровней до объектов более высокого уровня и представляет результат в виде csv таблицы.\n\rВ качестве альтернативного решения, но уже без привязки к BloodHound, можно рассмотреть программу Forest Druid.\n\rОбъекты первоначального доступа При построении векторов атак важно определить объекты первоначального доступа. В дальнейшем поиск векторов осуществляется в предположении о наличие контроля над указанными объектами. В BloodHound эквивалентом объекта первоначального доступа можно считать метку “owned”.\nРанее уже были кратко затронуты некоторые примеры объектов первоначального доступа. Для большего порядка и централизации информации приведу расширенный перечень объектов, которые могут рассматриваться в качестве отправных точек:\n Учетные записи, подверженные атаке asreproasting или kerberoasting (в ряде случаев) Учетные записи с паролями в описании или в материалах общедоступных утечек информации, а также сетевых папок Учетные записи, подверженные атаке методом распыления пароля Машинные учетные записи с предустановленными паролями (Diving into Pre-Created Computer Accounts, Diving Deeper Into Pre-created Computer Accounts, pre2k) Системы, обладающие критическими уязвимостями Учетные записи, позволяющие атакующему узнать NTLM v1 хеш от своих паролей Системы, позволяющие анонимное подключение Системы cо сторонними сервисами, позволяющими подобрать учетную запись и получить доступ (ssh, базы данных, vnc, web порталы и т.д.) Пользовательские учетные записи имеющие словарные пароли и позволяющие атакующему узнать NTLM v2 от хеш своих паролей Учетные записи, добытые при анализе защищенности Wi-Fi, основанного на WPA2 Enterprise Учетные записи, добытые из принтеров Системы, подверженные MouseJack  Выгрузка отчетов Некоторые утилиты используют, обрабатываемые в BloodHound данные, для выпуска статических отчетов. Познакомимся с двумя из них ближе.\nPlumHound PlumHound позволяет значительно упростить выпуск приложений к отчетам. Вот лишь некоторые из разделов, которые могут быть составлены с использованием указанной утилиты:\n перечень устаревших операционных систем с указанием DNS имен перечень сессий пользователей перечень учетных записей подверженных атаке Kerberoasting  \r\r\rПример страницы отчета PlumHound с информацией об учетных записях, подверженных атаке Kerberoasting\r\r\rВажно отметить, что программа рассчитана на добавление произвольных пользовательских запросов. Таким образом PlumHound может быть использована для работы с новыми сущностями.\nАнализ парольной политики Целесообразность анализа выгрузки NT-хэшей пользователей домена довольно дискуссионный вопрос. Мнения специалистов на этот счет разнятся, но если проводить указанный анализ, то стоит обратить внимание на инструмент DPAT-max.\nВ качестве вводных данных DPAT-max принимает potfile Hashcat, перечень учетных записей с NT-хэшами в формате pwdump, а также логин и пароль к BloodHound.\nИтоговый отчет имеет следующие разделы:\n\r\r\rРазделы отчета, составленного в DPAT-max\r\r\rБолее подробно ознакомиться с возможностями и устройством DPAT-max можно в блоге автора указанной утилиты: Max: BloodHound Domain Password Audit Tool.\nВизуализация В следующих статьях рассказывается о дополнительных способах визуализации сведений, собранных для BloodHound, в том числе с использованием Jupyter Notebooks:\n “Visualizing BloodHound Data with PowerBI” часть 1, часть 2 “Streamlining BloodHound Analytics” “Jupyter Notebooks for BloodHound Analytics and Alternative Visualizations”  \r\r\rПример созданной визуализации\r\r\rПрочие дополнения Также для общего развития приведу ряд утилит, которые не получилось отнести к какому-либо разделу ранее.\n ADExplorerSnapshot.py - конвертер снимка состояния домена, сделанного с помощью AD Explorer, в JSON файл импортируемый BloodHound. ldd2bh- конвертер ldapdomaindump в формат BloodHound, может пригодиться при релей атаках. ACLPwn- старый скрипт для автоматизации эксплуатации уязвимостей, выявленных в BloodHound Max- утилита, включающая в себя ряд различных модулей, часть из которых не была рассмотрена ранее FoxTerrier BofHound  Рекомендации по противодействию BloodHound Чтобы затруднить атакующему проведение разведки с помощью BloodHound следует минимизировать сбор сведений, которые он может получить. Для этого можно:\n Ограничить доступ к списку сессий пользователей. Запретить выгрузку перечня пользователей и групп из Active Directory по протоколу SAMRPC. Отключить анонимные учетные записи Исключить группу “Authenticated Users” из группы “pre-Windows 2000 compatible access” - источник  Промежуточный итог первой части Из рассмотренного ранее материала следуют выводы:\n BloodHound можно обогатить множеством новых атрибутов, объектов и связей “обогащённый” BloodHound можно дополнить новыми запросами на основе запросов можно строить автоматизированные отчеты или интерактивные визуализации  Часть 2. Управление векторами атак Как было показано ранее, BloodHound содержит множество данных, на основе которых можно строить вероятные вектора компьютерных атак. Управление указанными векторами позволяет решать различные задачи.\nС одной стороны защищающиеся могут проактивно определить наиболее вероятно атакуемые объекты домена с целью первоочередного устранения уязвимостей и недостатков в настройке указанных объектов.\nС другой стороны атакующие могут выявить наиболее приоритетные цели для проведения компьютерных атак с целью дальнейшего продвижения или закрепления в домене.\nСоздатели BloodHound разумеется не оставили без внимания такое перспективное направления для развития своего инструмента и выпустили на его основе полноценный продукт BloodHound Enterprise.\n\r\r\rПример интерфейса BloodHound Enterprise\r\r\rНа официальном сайте BloodHound присутствует множество маркетинговых лозунгов и это нормально для сайта платного продукта. Тем не менее кроме пестрых заголовков авторы BloodHound написали ряд статей на тему управления векторами атак:\n The Attack Path Management Manifesto 3 Foundational Pillars for Attack Path Management: Pillar 1 — Continuous \u0026 Comprehensive Mapping 3 Foundational Pillars for Attack Path Management: Pillar 2 — Empirical Impact Assessment Attack Path Management Pillars: Part 3 —Practical AD Security Remediation Guidance  Важно отметить, что BloodHound Enterprise обладает моделью распространения Software-as-a-Service, что в совокупности с отсутствием общедоступной пробной версии, не позволяет оценить этот продукт рядовому исследователю. Если у кого-то есть возможность предоставить доступ к интерфейсу BloodHound Enterprise, то буду признателен.\n\r\r\rТаблица сравнения и различий двух версий BloodHound\r\r\rПрежде чем выпустить платную версию, создатели BloodHound уже пробовали использовать его для управления векторами атак:\n Introducing the Adversary Resilience Methodology — Part One Introducing the Adversary Resilience Methodology — Part Two  Кроме того, некоторые исследователи смотрели на граф BloodHound с точки зрения анализа возможного распространения атакующего, в частности вредоносной программы вымогателя:\n BloodHound versus Ransomware: A Defender’s Guide Extending BloodHound: Track and Visualize Your Compromise Adversary Resilience Via Least Privilege Networking - Part 1 Adversary Resilience Via Least Privilege Networking – Part 2 Ransomulator  Значимые объекты Одним из ключевых вопросов при исследовании векторов атак является выявление наиболее значимых объектов.\nДля лучшего понимания приведу следующее нестрогое определение: наиболее значимый объект - объект, захват которого вносит существенный вклад в дальнейшее развитие векторов атак.\nНекоторые подходы к определению указанных объектов и оценки их значимости предпринимаются на практике, например в следующих инструментах:\n GoodHound Kangal + статья: Combined Attack Path Analysis with BloodHound and Kangal  \r\r\rПример запуска GoodHound\r\r\r\r\r\rПример до преобразования в Kangal\r\r\r\r\r\rПример после преобразования в Kangal\r\r\rТакже на момент написания настоящего материала был опубликован цикл статей:\n BloodHound — Calculating AD metrics 0x01 BloodHound — Calculating AD metrics 0x02  Не будем заострять внимание на разборе каждого из представленных инструментов. Отмечу, что предложенные в них подходы к оценкам имеют место, но видятся мне относительно грубыми. На этом моменте у меня появилось желание изобрести свой велосипед.\nПредлагаемый подход к оценке значимости Для начала более формализовано опишу задачу. Имеется взвешенный мультиорграф, отображающий вероятные вектора атак в домене Active Directory, построенные от объектов первоначального доступа до заданной особо привилегированной цели, например группы “Domain Admins”. Требуется определить меру значимости каждого, входящего в указанный мультиорграф элемента с точки зрения атакующей или защищающей стороны.\nНа практике построить наиболее полный мультиорграф, выделить объекты первоначального доступа, а также распределить веса ребер возможно с помощью способов, рассмотренных ранее в первой части.\nВ ходе поиска решения, кроме Kangal и GoodHound, была также рассмотрена целесообразность использования встроенных в neo4j алгоритмов центральности. Учитывая, что настоящий материал не претендует на публикацию в журнале “Science”, без строгих сравнений и разных выкладок просто отмечу, что личная чуйка говорила, что можно найти нечто лучше.\nВ итоге самой интересной и перспективной мне показалась идея, основанная на электрических цепях. Про нечто подобное можно почитать в диссертации “Математические модели ранжирования вершин в графах коммуникационных сетей”.\nЧуть более подробнее расскажу о предлагаемой идее. Для иллюстрации рассмотрим следующий надуманный пример:\n\rУчетная запись, подверженная атаке AS-REP roasting, выступает в качестве точки первоначального доступа, а DC - особо привилегированная цель.\nДля примера составим таблицу с весами:\n   Название Вес     “может зайти по RDP” 40   “является админом” 5   “входит” 1   “имеет сессию” 50   “DCSync” 5    Далее полученный граф преобразовывается в электрическую схему по следующим правилам:\n Точки первоначального доступа преобразуются в источники ЭДС (тока). Также в качестве улучшения имеет смысл также составить отдельную таблицу для различных классов объектов первоначального доступа, в которой в зависимости от вероятности захвата указанных объектов ставить в соответствие различные напряжения. Ребро перехода преобразуются в резистор, последовательно соединенный с диодом. Величина сопротивления прямо пропорциональна весу ребра. Диод необходим для учета свойства ориентированности графа. Особо привилегированная цель преобразуется в заземление.  В результате получившуюся долю величины тока, проходящего через выбранный объект, от общего количества поданной величины тока, можно считать мерой значимости указанного объекта.\nТем, кто знаком с правилами Кирхгофа, преимущества предлагаемого подхода должны быть очевидны.\nC помощью программы Multisim была смоделирована электрическая схема с учетом предложенных преобразований:\n\rВ рассматриваемом случае, мера значимости верхних объектов составляет 56.5 единиц, а нижних 43.5. Таким образом, с точки зрения атакующего верхний путь на 13 процентов предпочтительнее нижнего. Разумеется это всего лишь иллюстрирующий пример и на практике схемы получаются куда сложнее.\nАвтоматизировать построение и расчёт электрических схем на языке Python можно с помощью модуля ltspice.\nНемного лирики. Ток стремится идти по пути наименьшего сопротивления. Уместна аналогия с водой которая стекает со склона с разными углами наклона. Природа сама строит наиболее подходящий маршрут, а если по нему и так уже течет предостаточно, то вода все равно найдет другой путь.\n\rИтоговый граф, содержащий посчитанные оценки значимости, можно выгрузить в общепринятом формате (graphml) и визуализировать с помощью различных сторонних инструментов. В этом плане хорошо себя показал yEd, в котором, в частности, нетрудно установить соотношение между толщиной линии и количеством тока, проходящего по эквивалентной схеме.\nДля примера тестовый граф, приведенный ниже:\n\rПреобразуется в следующую интерактивную визуализацию:\n\rЗаключение Представленный материал не содержит готового решения, а скорее включает множество полезных ссылок для самостоятельного изучения и вдохновения. Тем не менее ряд из рассмотренных идей могут быть полезны специалистам, желающим усовершенствовать свои подходы к анализу небезопасных конфигураций Active Directory.\nТакже в завершении был предложен и кратко описан свой собственный алгоритм оценки значимости объектов Active Directory с точки зрения атакующих и защищающих.\n","wordCount":"3533","inLanguage":"ru","image":"https://ardent101.github.io/posts/bh_improvement/images/logo_final.jpg","datePublished":"2023-05-28T08:31:03Z","dateModified":"2023-05-28T08:31:03Z","author":{"@type":"Person","name":"Ardent101"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ardent101.github.io/posts/bh_improvement/"},"publisher":{"@type":"Organization","name":"Ardent101","logo":{"@type":"ImageObject","url":"https://ardent101.github.io/static/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ardent101.github.io/ accesskey=h title="Главная (Alt + H)"><img src=https://ardent101.github.io/apple-touch-icon.png alt=logo aria-label=logo height=35>Главная</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://ardent101.github.io/archives/ title=Архив><span>Архив</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Немного про построение векторов атак</h1><div class=post-meta><span title="2023-05-28 08:31:03 +0000 +0000">мая 28, 2023</span>&nbsp;·&nbsp;17 мин&nbsp;·&nbsp;Ardent101</div></header><figure class=entry-cover><img loading=lazy srcset="https://ardent101.github.io/posts/bh_improvement/images/logo_final_hu55d0095a3840f8174e7f83ac8fdd2481_153165_360x0_resize_q75_box.jpg 360w ,https://ardent101.github.io/posts/bh_improvement/images/logo_final_hu55d0095a3840f8174e7f83ac8fdd2481_153165_480x0_resize_q75_box.jpg 480w ,https://ardent101.github.io/posts/bh_improvement/images/logo_final_hu55d0095a3840f8174e7f83ac8fdd2481_153165_720x0_resize_q75_box.jpg 720w ,https://ardent101.github.io/posts/bh_improvement/images/logo_final.jpg 896w" sizes="(min-width: 768px) 720px, 100vw" src=https://ardent101.github.io/posts/bh_improvement/images/logo_final.jpg alt width=896 height=587></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Оглавление</span></summary><div class=inner><ul><li><a href=#%d0%b2%d0%b2%d0%b5%d0%b4%d0%b5%d0%bd%d0%b8%d0%b5 aria-label=Введение>Введение</a></li><li><a href=#%d0%b8%d0%bc%d0%b5%d1%8e%d1%89%d0%b8%d0%b5%d1%81%d1%8f-%d1%80%d0%b5%d1%88%d0%b5%d0%bd%d0%b8%d1%8f aria-label="Имеющиеся решения">Имеющиеся решения</a></li><li><a href=#%d1%87%d0%b0%d1%81%d1%82%d1%8c-1-%d1%83%d0%bb%d1%83%d1%87%d1%88%d0%b5%d0%bd%d0%b8%d1%8f-bloodhound aria-label="Часть 1. Улучшения Bloodhound">Часть 1. Улучшения Bloodhound</a><ul><li><a href=#%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d1%82%d0%b5%d0%bb%d1%8c%d1%81%d0%ba%d0%b8%d0%b5-%d1%85%d1%80%d0%b0%d0%bd%d0%b8%d0%bc%d1%8b%d0%b5-%d0%b7%d0%b0%d0%bf%d1%80%d0%be%d1%81%d1%8b aria-label="Пользовательские хранимые запросы">Пользовательские хранимые запросы</a></li><li><a href=#%d0%b4%d0%be%d0%b1%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bd%d0%be%d0%b2%d1%8b%d1%85-%d1%81%d1%83%d1%89%d0%bd%d0%be%d1%81%d1%82%d0%b5%d0%b9 aria-label="Добавление новых сущностей">Добавление новых сущностей</a><ul><li><a href=#certipy aria-label=Certipy>Certipy</a></li><li><a href=#%d1%80%d1%83%d1%87%d0%bd%d0%be%d0%b5-%d0%b4%d0%be%d0%b1%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5 aria-label="Ручное добавление">Ручное добавление</a></li><li><a href=#%d0%bf%d1%80%d0%b8%d0%ba%d0%bb%d0%b0%d0%b4%d0%bd%d0%be%d0%b9-%d0%b8-%d1%81%d0%b5%d1%82%d0%b5%d0%b2%d0%be%d0%b9-%d1%83%d1%80%d0%be%d0%b2%d0%bd%d0%b8 aria-label="Прикладной и сетевой уровни">Прикладной и сетевой уровни</a></li><li><a href=#%d0%bf%d1%80%d0%b8%d0%b2%d0%b8%d0%bb%d0%b5%d0%b3%d0%b8%d0%b8 aria-label=Привилегии>Привилегии</a></li><li><a href=#c%d0%bf%d0%b8%d1%81%d0%ba%d0%b8-%d0%ba%d0%be%d0%bd%d1%82%d1%80%d0%be%d0%bb%d1%8f-%d0%b4%d0%be%d1%81%d1%82%d1%83%d0%bf%d0%b0 aria-label="Cписки контроля доступа">Cписки контроля доступа</a></li><li><a href=#%d0%bb%d0%be%d0%ba%d0%b0%d0%bb%d1%8c%d0%bd%d1%8b%d0%b5-%d0%b0%d0%b4%d0%bc%d0%b8%d0%bd%d0%b8%d1%81%d1%82%d1%80%d0%b0%d1%82%d0%be%d1%80%d1%8b aria-label="Локальные администраторы">Локальные администраторы</a></li><li><a href=#%d0%b0%d1%83%d1%82%d0%b5%d0%bd%d1%82%d0%b8%d1%84%d0%b8%d0%ba%d0%b0%d1%86%d0%b8%d0%be%d0%bd%d0%bd%d1%8b%d0%b5-%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d0%b5 aria-label="Аутентификационные данные">Аутентификационные данные</a></li><li><a href=#%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d1%82%d0%b5%d0%bb%d1%8c%d1%81%d0%ba%d0%b8%d0%b5-%d1%81%d0%b5%d1%80%d0%b2%d0%b8%d1%81%d0%bd%d1%8b%d0%b5-%d1%83%d1%87%d0%b5%d1%82%d0%bd%d1%8b%d0%b5-%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d0%b8 aria-label="Пользовательские сервисные учетные записи">Пользовательские сервисные учетные записи</a></li></ul></li><li><a href=#%d0%b2%d0%b5%d1%81%d0%be%d0%b2%d1%8b%d0%b5-%d0%ba%d0%be%d1%8d%d1%84%d1%84%d0%b8%d1%86%d0%b8%d0%b5%d0%bd%d1%82%d1%8b aria-label="Весовые коэффициенты">Весовые коэффициенты</a></li><li><a href=#%d0%bc%d0%bd%d0%be%d0%b3%d0%be%d1%83%d1%80%d0%be%d0%b2%d0%bd%d0%b5%d0%b2%d0%b0%d1%8f-%d0%b0%d1%80%d1%85%d0%b8%d1%82%d0%b5%d0%ba%d1%82%d1%83%d1%80%d0%b0-%d0%b1%d0%b5%d0%b7%d0%be%d0%bf%d0%b0%d1%81%d0%bd%d0%be%d1%81%d1%82%d0%b8 aria-label="Многоуровневая архитектура безопасности">Многоуровневая архитектура безопасности</a></li><li><a href=#%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d1%8b-%d0%bf%d0%b5%d1%80%d0%b2%d0%be%d0%bd%d0%b0%d1%87%d0%b0%d0%bb%d1%8c%d0%bd%d0%be%d0%b3%d0%be-%d0%b4%d0%be%d1%81%d1%82%d1%83%d0%bf%d0%b0 aria-label="Объекты первоначального доступа">Объекты первоначального доступа</a></li><li><a href=#%d0%b2%d1%8b%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b0-%d0%be%d1%82%d1%87%d0%b5%d1%82%d0%be%d0%b2 aria-label="Выгрузка отчетов">Выгрузка отчетов</a><ul><li><a href=#plumhound aria-label=PlumHound>PlumHound</a></li><li><a href=#%d0%b0%d0%bd%d0%b0%d0%bb%d0%b8%d0%b7-%d0%bf%d0%b0%d1%80%d0%be%d0%bb%d1%8c%d0%bd%d0%be%d0%b9-%d0%bf%d0%be%d0%bb%d0%b8%d1%82%d0%b8%d0%ba%d0%b8 aria-label="Анализ парольной политики">Анализ парольной политики</a></li></ul></li><li><a href=#%d0%b2%d0%b8%d0%b7%d1%83%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f aria-label=Визуализация>Визуализация</a></li><li><a href=#%d0%bf%d1%80%d0%be%d1%87%d0%b8%d0%b5-%d0%b4%d0%be%d0%bf%d0%be%d0%bb%d0%bd%d0%b5%d0%bd%d0%b8%d1%8f aria-label="Прочие дополнения">Прочие дополнения</a></li><li><a href=#%d1%80%d0%b5%d0%ba%d0%be%d0%bc%d0%b5%d0%bd%d0%b4%d0%b0%d1%86%d0%b8%d0%b8-%d0%bf%d0%be-%d0%bf%d1%80%d0%be%d1%82%d0%b8%d0%b2%d0%be%d0%b4%d0%b5%d0%b9%d1%81%d1%82%d0%b2%d0%b8%d1%8e-bloodhound aria-label="Рекомендации по противодействию BloodHound">Рекомендации по противодействию BloodHound</a></li></ul></li><li><a href=#%d0%bf%d1%80%d0%be%d0%bc%d0%b5%d0%b6%d1%83%d1%82%d0%be%d1%87%d0%bd%d1%8b%d0%b9-%d0%b8%d1%82%d0%be%d0%b3-%d0%bf%d0%b5%d1%80%d0%b2%d0%be%d0%b9-%d1%87%d0%b0%d1%81%d1%82%d0%b8 aria-label="Промежуточный итог первой части">Промежуточный итог первой части</a></li><li><a href=#%d1%87%d0%b0%d1%81%d1%82%d1%8c-2-%d1%83%d0%bf%d1%80%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%b2%d0%b5%d0%ba%d1%82%d0%be%d1%80%d0%b0%d0%bc%d0%b8-%d0%b0%d1%82%d0%b0%d0%ba aria-label="Часть 2. Управление векторами атак">Часть 2. Управление векторами атак</a></li><li><a href=#%d0%b7%d0%bd%d0%b0%d1%87%d0%b8%d0%bc%d1%8b%d0%b5-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d1%8b aria-label="Значимые объекты">Значимые объекты</a><ul><li><a href=#%d0%bf%d1%80%d0%b5%d0%b4%d0%bb%d0%b0%d0%b3%d0%b0%d0%b5%d0%bc%d1%8b%d0%b9-%d0%bf%d0%be%d0%b4%d1%85%d0%be%d0%b4-%d0%ba-%d0%be%d1%86%d0%b5%d0%bd%d0%ba%d0%b5-%d0%b7%d0%bd%d0%b0%d1%87%d0%b8%d0%bc%d0%be%d1%81%d1%82%d0%b8 aria-label="Предлагаемый подход к оценке значимости">Предлагаемый подход к оценке значимости</a></li></ul></li><li><a href=#%d0%b7%d0%b0%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5 aria-label=Заключение>Заключение</a></li></ul></div></details></div><div class=post-content><h2 id=введение>Введение<a hidden class=anchor aria-hidden=true href=#введение>#</a></h2><p>Как правило, домен на базе Active Directory обладает значительным количеством объектов, свойств и связей между ними. В общем случае «вручную» выявить недостатки в настройке домена и на их основе построить вероятный вектор атаки является довольно трудоемкой задачей и справится с ней без вспомогательных программных средств не представляется возможным.</p><p>В настоящем материале будет представлен обзор некоторых программных средств, использующихся для автоматизированного построения вероятных атак в домене. Кроме того, будут рассмотрены некоторые подходы к улучшению уже имеющихся решений, а также предложен собственный алгоритм к выявлению наиболее приоритетных целей атак.</p><p>Важно отметить, что материал рассчитан на читателя, обладающего опытом по тестированию на проникновение Active Directory.</p><h2 id=имеющиеся-решения>Имеющиеся решения<a hidden class=anchor aria-hidden=true href=#имеющиеся-решения>#</a></h2><p>На момент написания статьи в общем доступе имеется множество инструментов по анализу недостатков настроек Active Directory. Например:</p><ul><li><a href=https://github.com/BloodHoundAD/BloodHound>Bloodhound</a></li><li><a href=https://github.com/skelsec/jackdaw>Jackdaw</a></li><li><a href=https://github.com/lkarlslund/adalanche>Adalanche</a></li><li><a href=https://github.com/vletoux/pingcastle>Pingcastle</a></li><li><a href=https://www.purple-knight.com/>Purple Knight</a></li><li><a href=https://github.com/xforcered/StandIn>StandIn</a></li><li><a href=https://github.com/cyberark/zBang>zBang</a></li><li><a href=https://github.com/adrecon/ADRecon>ADRecon</a></li><li><a href=https://github.com/ANSSI-FR/AD-control-paths>AD-control-paths</a></li><li><a href=https://github.com/microsoft/AttackSurfaceAnalyzer>AttackSurfaceAnalyzer</a></li></ul><p>Если грубо, то принцип работы инструментов заключается в сборе информации об исследуемом домене по протоколу LDAP. Как правило инструменты содержат ряд типовых запросов, проверяющих наличие определенного недостатка или небезопасной настройки. В дальнейшем, полученные ответы представляются для анализа специалисту.</p><p>Собранные результаты могут быть представлены в интерактивном виде (BloodHound, Adalanche, Jackdaw). В этом случае инструмент обладает графической оболочкой к некоторой базе данных с возможностью выполнения уточняющих запросов со стороны специалиста.</p><p>Другим способом представления результатов является статический сгенерированный отчет (PingCastle, Purple Knight).</p><p>Существует небезосновательное мнение, что защищающиеся мыслят списками, а атакующие мыслят графами, и пока так – последние будут побеждать.</p><p>Поэтому особой популярностью пользуются именно интерактивные инструменты, отображающие результат запросов в виде графа. На практике одним из наиболее удобных и полезных из интерактивных инструментов считается BloodHound. К его преимуществам можно отнести наличие активного сообщества пользователей, возможность расширения функционала, а также удобный интерфейс. Фактически без BloodHound не обходится ни одно тестирование на проникновение домена на базе Active Directory. Именно поэтому далее основное внимание будет уделено этому средству.</p><p>Тем не менее некоторые из других представленных инструментов также заслуживают внимания. Особенно актуально использование альтернативных средств с точки зрения перекрестной проверки получаемых результатов.</p><p>Разумеется самым лучшим способом для оценки инструмента является &ldquo;метод мачете&rdquo;, то есть просто начать пользоваться, пусть даже по началу и не особо вдаваясь в детали. Рекомендую попробовать применить указанный метод к Jackdaw и Adalanche.</p><p><figure><img src=images/jackdaw.png alt=jackdaw><figcaption><p style=text-align:center>Пример интерфейса Jackdaw</p></figcaption></figure></p><p><figure><img src=images/adalanche_example.png alt=adalanche_example><figcaption><p style=text-align:center>Пример интерфейса Adalanche</p></figcaption></figure></p><h2 id=часть-1-улучшения-bloodhound>Часть 1. Улучшения Bloodhound<a hidden class=anchor aria-hidden=true href=#часть-1-улучшения-bloodhound>#</a></h2><p>Далее рассмотрим некоторые способы расширения возможностей BloodHound.</p><h3 id=пользовательские-хранимые-запросы>Пользовательские хранимые запросы<a hidden class=anchor aria-hidden=true href=#пользовательские-хранимые-запросы>#</a></h3><p>BloodHound представляет графическую оболочку для работы с базой данных Neo4j. Запросы к базе Neo4j бывают:</p><ul><li>&ldquo;графовые&rdquo; - результат представляет граф, который может быть отображен в приложении BloodHound.</li><li>&ldquo;консольные&rdquo; - результат представляет таблицу со строками, которую можно посмотреть в Neo4j Browser. В интерфейсе BloodHound работать с указанными запросами нельзя.</li></ul><p>BloodHound позволяет специалисту добавить в интерфейс собственные наиболее часто используемые графовые запросы. Для этого необходимо сохранить указанные запросы в предопределенном формате в файл <code>customqueries.json</code>.</p><p>В Windows данный файл хранится по следующему пути:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\Users[USERNAME]\AppData\Roaming\BloodHound\customqueries.json</span>
</span></span></code></pre></div><p>В Linux:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>~/.config/bloodhound/customqueries.json
</span></span></code></pre></div><p>Посмотреть примеры дополнительных пользовательских запросов, а также ознакомиться со структурой файла <code>customqueries.json</code>, можно в следующих источниках:</p><ul><li><a href=https://neo4j.com/docs/cypher-manual/current/introduction/>Официальная документация Neo4j по Cypher</a></li><li><a href=https://blog.cptjesus.com/posts/introtocypher/>Bloodhound: Intro To Cypher</a> - более подробно о языке запросов</li><li><a href=https://hausec.com/2019/09/09/bloodhound-cypher-cheatsheet/>BloodHound Cypher Cheatsheet</a>- строковые и графовые запросы</li><li><a href=https://github.com/mgeeky/Penetration-Testing-Tools/blob/master/red-teaming/bloodhound/Handy-BloodHound-Cypher-Queries.md>mgeeky</a> - множество группированных запросов</li></ul><h3 id=добавление-новых-сущностей>Добавление новых сущностей<a hidden class=anchor aria-hidden=true href=#добавление-новых-сущностей>#</a></h3><p>По умолчанию в BloodHound обрабатывается информация, добытая с помощью штатного сборщика - SharpHound. Тем не менее архитектура программы позволяет добавлять новые сущности: объекты, атрибуты объектов, а также связи.</p><p>Прежде чем выявлять какие-либо векторы атак целесообразно максимально наполнить пространство возможных вариантов, то есть собрать и загрузить в BloodHound как можно больше информации.</p><h4 id=certipy>Certipy<a hidden class=anchor aria-hidden=true href=#certipy>#</a></h4><p>Рассмотрим один из актуальных примеров добавления новых сущностей в BloodHound.</p><p>Летом 2021 года была опубликована знаковая статья <a href=https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf>&ldquo;Certified Pre-Owned:<br>Abusing Active Directory Certificate Services&rdquo;</a>. В результате публикации арсенал специалистов по тестированию на проникновение обогатился множеством новых методов атак, связанных с эксплуатацией небезопасных настроек центров сертификации.</p><p>Со временем появились программные средства, автоматизирующие поиск и эксплуатацию уязвимых настроек. Одно из указанных средств под названием <a href=https://github.com/ly4k/Certipy>Certipy</a> имеет модуль сбора информации, обладающий возможностью интеграции с BloodHound.</p><p>В итоге в BloodHound могут быть дополнительно загружены следующие данные:</p><ul><li>настройки центров сертификаций</li><li>шаблоны для выпуска сертификатов</li></ul><p>Также с помощью Certipy в BloodHound добавляются новые связи (&ldquo;enroll&rdquo;, &ldquo;ManageCA&rdquo; и т.д.) между стандартными и новыми объектами.</p><p>Более того, автор Certipy также создал <a href=https://github.com/ly4k/BloodHound>собственную версию</a> BloodHound, чтобы красиво отображать новые сущности, то есть отрисовать их иконки и вкладку со свойствами, появляющуюся при выделении объекта.</p><p><figure><img src=images/certipy_examples_1.png alt=certipy_examples_1><figcaption><p style=text-align:center>Пример отображения новых объектов в версии BloodHound от создателя Certipy</p></figcaption></figure></p><p><figure><img src=images/certipy_examples_2.png alt=certipy_examples_2><figcaption><p style=text-align:center>Пример содержимого во вкладке центра сертификации</p></figcaption></figure></p><p><figure><img src=images/certipy_examples_3.png alt=certipy_examples_3><figcaption><p style=text-align:center>Пример отображения прав на выпуск сертификата</p></figcaption></figure></p><p>Кроме того, для удобной работы с полученными данными в Certipy предусмотрен перечень типовых запросов к BloodHound.</p><p><figure><img src=images/certipy_examples_4.png alt=certipy_examples_4><figcaption><p style=text-align:center>Пример новых запросов с учетом шаблонов для выдачи сертификатов</p></figcaption></figure></p><p>Важно отметить, что при всем своем великолепии Certipy иногда предоставляет неверную информацию. Это связано с некорректной проверкой прав доступа к шаблонам сертификатов. В этом плане лучше ориентироваться на PingCastle, в котором анализ настроек производится корректно.</p><p>Используемые источники:</p><ul><li><a href=https://research.ifcr.dk/certipy-2-0-bloodhound-new-escalations-shadow-credentials-golden-certificates-and-more-34d1c26f0dc6>Certipy 2.0: BloodHound, New Escalations, Shadow Credentials, Golden Certificates, and more!</a></li><li><a href=https://research.ifcr.dk/certipy-4-0-esc9-esc10-bloodhound-gui-new-authentication-and-request-methods-and-more-7237d88061f7>Certipy 4.0: ESC9 & ESC10, BloodHound GUI, New Authentication and Request Methods — and more!</a></li></ul><h4 id=ручное-добавление>Ручное добавление<a hidden class=anchor aria-hidden=true href=#ручное-добавление>#</a></h4><p>Из рассмотренного ранее примера, видно что в BloodHound возможно самостоятельно добавить поддержку абсолютно новых сущностей.</p><p>Полный разбор добавления новых сущностей выходит за рамки настоящего материала. Тем не менее, для более опытных читателей обозначу направление, позволяющее разобраться в указанном вопросе.</p><p>Рекомендую взять две следующие версии BloodHound:</p><ul><li><a href=https://github.com/BloodHoundAD/BloodHound/tree/4.2>официальная 4.2.0</a></li><li><a href=https://github.com/ly4k/BloodHound/releases/tag/v4.2.0-ly4k>модернизированная для Certipy 4.2.0</a></li></ul><p>Далее с помощью <a href="https://winmerge.org/?lang=ru">WInMerge</a> требуется сравнить указанные версии между собой. В результате сравнения будет видно, где и как требуется подправить код программы. Остается всего-то по аналогии внести необходимые изменения и заново скомпилировать программу.</p><p>В целом базовых знаний в программировании достаточно, чтобы разобраться как добавить абсолютно новый объект в BloodHound.</p><h4 id=прикладной-и-сетевой-уровни>Прикладной и сетевой уровни<a hidden class=anchor aria-hidden=true href=#прикладной-и-сетевой-уровни>#</a></h4><p>Продолжим рассматривать идеи для обогащения BloodHound новыми сущностями.</p><p>Прежде всего стоит отметить, что BloodHound работает с информацией &ldquo;административного&rdquo; уровня, то есть с атрибутами объектов домена. Тем не менее можно добавить другие уровни: &ldquo;прикладной&rdquo; и &ldquo;сетевой&rdquo;.</p><p><img src=images/levels.png alt=levels></p><p>&ldquo;Прикладной&rdquo; уровень содержит информацию об используемом программном обеспечении. По сути добавление объектов на прикладном уровне сводится к инструментальному сканированию на предмет наличия критических уязвимостей.</p><p>Допустим один из серверов домена подвержен MS17-10. В этом случае имеет смысл отметить указанный сервер, как захваченный и дальнейшее построение векторов атак проводить с учетом новой начальной точки.</p><p>Также на прикладном уровне возможно выделять веб-приложения для последующего поиска уязвимостей или перебора учетных записей. Осуществить указанный поиск возможно с помощью Witness-подобных инструментов, например <a href=https://github.com/sensepost/gowitness>GoWitness</a>.</p><p>На &ldquo;сетевом&rdquo; уровне следует оценивать доступность объекта с точки зрения правил разграничения сетевого доступа. Проверить доступность можно следующими двумя способами:</p><ul><li>проанализировав настройки правил в конфигурационных файлах телекоммуникационного оборудования</li><li>выполнив сканирование</li></ul><p>В плане сетевого сканирования особо интересен инструмент <a href=https://github.com/zeronetworks/cornershot>cornershot</a>. Одной из отличительных черт указанного инструмента является возможность проверки сетевой доступности узла Б со стороны узла Ц, находясь на узле А.</p><p>Таким образом, в результате анализа &ldquo;сетевого&rdquo; уровня можно уменьшить количество ложных векторов, например:</p><ul><li>присутствует ребро &ldquo;CanRDP&rdquo;, но по факту по RDP подключиться нельзя</li><li>присутствует критическая уязвимость, но отсутствует сетевой доступ к службе, необходимой для эксплуатации уязвимости</li></ul><p>Попытка реализовать рассмотренные подходы предпринималась в инструментах <a href=https://github.com/zeronetworks/BlueHound>BlueHound</a>, <a href=https://github.com/zeronetworks/BloodHound-Tools/tree/main/ShotHound>ShotHound</a>.</p><p><figure><img src=images/BlueHound_interface.png alt=blueHound_interface><figcaption><p style=text-align:center>Пример интерфейса BlueHound</p></figcaption></figure></p><p>Также возможно поискать системы с несколькими сетевыми интерфейсами:</p><ul><li><a href=https://github.com/mubix/IOXIDResolver>IOXIDResolver</a></li><li><a href=https://github.com/S3cur3Th1sSh1t/SharpOxidResolver>SharpOxidResolver</a></li><li><a href=https://github.com/hdm/nextnet>Nextnet</a></li></ul><p>С помощью приведенных инструментов можно выявить сетевой доступ в сторонние подсети, например технологические.</p><h4 id=привилегии>Привилегии<a hidden class=anchor aria-hidden=true href=#привилегии>#</a></h4><p>Тот факт, что Sharphound собирает множество информации из групповых политик домена, не означает, что больше ничего интересного в них найти не получится.</p><p>В 2020 году Riccardo Ancarani написал замечательную статью <a href=https://riccardoancarani.github.io/2020-02-06-extending-bloodhound-pt1/>Extending BloodHound Part 1 - GPOs and User Right Assignment</a> , в которой рассказывается, как дополнить BloodHound информацией о наличии критичных привилегий у пользователей домена.</p><p>Дело в том, что групповые политики могут использоваться для назначения привилегий, в том числе <a href=/posts/tokens_theory/#%D1%82%D0%BE%D0%BA%D0%B5%D0%BD%D1%8B-%D0%BF%D1%80%D0%B8%D0%B2%D0%B8%D0%BB%D0%B5%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D1%83%D1%87%D0%B5%D1%82%D0%BD%D1%8B%D1%85-%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B5%D0%B9>&ldquo;опасных&rdquo;</a>, например:</p><ul><li>SeAssignPrimaryToken</li><li>SeBackupPrivilege</li><li>SeCreateTokenPrivilege</li><li>SeDebugPrivilege</li><li>SeImpersonatePrivilege</li><li>SeLoadDriverPrivilege</li><li>SeRestorePrivilege</li><li>SeTakeOwnershipPrivilege</li><li>SeTcbPrivilege</li></ul><p>Обладание любой из указанных привилегий позволяет пользователю успешно локально повысить свои права до уровня системы. Более подробно об эксплуатации указанных привилегий можно посмотреть в докладе <a href=https://github.com/AlessandroZ/BeRoot/blob/master/Windows/templates/RomHack%202018%20-%20Andrea%20Pierini%20-%20whoami%20priv%20-%20show%20me%20your%20Windows%20privileges%20and%20I%20will%20lead%20you%20to%20SYSTEM.pdf>&ldquo;Show me your privileges and I will lead you to SYSTEM&rdquo;</a></p><p>В BloodHound получившийся граф атаки выглядит следующим образом:</p><p><img src=images/privilege_privesc.png alt=privilege_privesc></p><p>Кроме того, важно выделить привилегию <code>SeEnableDelegationPrivilege</code>, которая <a href=/posts/kerberos_delegation/>позволяет</a> скомпрометировать не отдельную систему, а домен целиком.</p><h4 id=cписки-контроля-доступа>Cписки контроля доступа<a hidden class=anchor aria-hidden=true href=#cписки-контроля-доступа>#</a></h4><p>Вопрос улучшения Bloodhound интересует и других отечественных исследователей. Не так давно Дмитрий Неверов <a href=https://habr.com/ru/users/Solar_Pentest/posts/>опубликовал</a> три статьи на эту тему.</p><p>В одной из статей <a href=https://habr.com/ru/companies/solarsecurity/articles/681108/>&ldquo;Расширение списка ACE для BloodHound&rdquo;</a> показывается, как добавить в BloodHound следующие новые ребра:</p><ul><li>WriteGPLink</li><li>WriteGPOptions</li><li>WriteSAMAccountName</li><li>WriteUserAccountControl</li><li>WriteTSInitialProgram</li><li>WriteScriptPath</li></ul><p><img src=images/ACEs_edges.jpg alt=aces_edges></p><p>Рекомендую ознакомиться со статьями Дмитрия целиком. Cреди прочего в его материалах раскрыт технический процесс внедрения новых сущностей в BloodHound.</p><p>Отмечу, что список рассмотренных в статье прав, можно дополнить расширенным правом <code>DS-Validated-Write-Computer</code>, позволяющим проводить атаку <a href=/posts/shadow_creds/#shadow-credentials>ShadowCredentials</a>.</p><h4 id=локальные-администраторы>Локальные администраторы<a hidden class=anchor aria-hidden=true href=#локальные-администраторы>#</a></h4><p>В другой статье <a href=https://habr.com/ru/companies/solarsecurity/articles/707190/>BloodHound: групповые политики и локальный администратор</a> Дмитрий Неверов показывает, как и откуда добавить в BloodHound учетные записи локальных администраторов.</p><p><img src=images/LocalAdmins.png alt=LocalAdmins></p><p>От себя могу заметить, что учетные записи локальных администраторов также могут быть подобраны перебором или извлечены из <a href="https://adsecurity.org/?p=2288">SYSVOL</a>.</p><h4 id=аутентификационные-данные>Аутентификационные данные<a hidden class=anchor aria-hidden=true href=#аутентификационные-данные>#</a></h4><p>В качестве аутентификационных данных можно рассматривать связку названия домена, идентификатора учетной записи и либо пароля в открытом виде, либо NT-хеша пароля.</p><p>Анализ паролей и NT-хешей полезен при выборе наиболее подходящих целей для атак методом распыления паролей. Автоматизация указанной идеи описана в статье Неверова <a href=https://habr.com/ru/companies/solarsecurity/articles/719714/>&ldquo;BloodHound и результаты атаки PasswordSpray&rdquo;</a>.</p><p>Также выявление одинаковых паролей рассматривается в статьях:</p><ul><li><a href=https://porterhau5.com/blog/representing-password-reuse-in-bloodhound/>Representing Password Reuse in BloodHound</a></li><li><a href=https://posts.specterops.io/case-study-password-analysis-with-bloodhound-a3d264736c7>Case Study: Password Analysis with BloodHound</a></li><li><a href=https://www.trustedsec.com/blog/expanding-the-hound-introducing-plaintext-field-to-compromised-accounts/>Expanding the Hound: Introducing Plaintext Field to Compromised Accounts</a></li></ul><p>В последней статье для загрузки паролей предлагается использовать утилиту <a href=https://github.com/trustedsec/CrackHound>CrackHound</a>. Альтернативная утилита - <a href=https://github.com/knavesec/Max/blob/master/wiki/add-spw.md>add-spw из Max</a>.</p><p><img src=images/spw-example.png alt=spw-example></p><p><img src=images/password-reuse-query.png alt=password-reuse-query></p><p>Кроме того, анализ аутентификационных данных можно проводить на предмет выявления разных учетных записей, принадлежащих одному и тому же пользователю. Подробнее почитать об этом можно в статье: <a href=https://insomniasec.com/blog/bloodhound-shared-accounts>Exploring Users With Multiple Accounts In BloodHound</a>.</p><p><img src=images/sameuser.png alt=sameuser></p><p>В рассмотренных примерах авторы оперируют паролями или их NT-хешами, но можно пойти еще дальше и добавить NTLM v1 хеши.</p><p>Получение NTLM v1 хеша пароля к некоторой учетной записи равноценно получению доступа к указанной учетной записи ввиду возможности проведения атаки методом полного перебора за приемлемое время на соответствующем оборудовании (до 2 суток на ферме из 8 RTX 2080).</p><p>Разбор атак на NTLM v1 выходит за рамки настоящего материала. Отмечу, что в ряде случаев, когда не получается использовать радужные таблицы, важным становится вопрос выделения наиболее приоритетных хешей для брута. Именно тогда может пригодиться расширение объектов BloodHound новым атрибутом, отображающим наличие NTLM v1 хеша.</p><h4 id=пользовательские-сервисные-учетные-записи>Пользовательские сервисные учетные записи<a hidden class=anchor aria-hidden=true href=#пользовательские-сервисные-учетные-записи>#</a></h4><p>Еще один примитив, который может быть добавлен в BloodHound - ребро, свидетельствующее об использовании пользовательской учетной записи в качестве сервисной на определенной системе. По <a href=https://whynotsecurity.com/blog/max2/>словам</a> автора в 2/3 случаев удается получить пароль в открытом виде к указанной учетной записи из хранилища секретов LSA.</p><p><img src=images/spn-rel.png alt=spn-rel></p><p>Для создания указанного ребра можно использовать утилиту <a href=https://github.com/knavesec/Max/blob/master/wiki/add-spns.md>add-spns из Max</a>.</p><h3 id=весовые-коэффициенты>Весовые коэффициенты<a hidden class=anchor aria-hidden=true href=#весовые-коэффициенты>#</a></h3><p>Рассмотрим следующие два результата запроса на поиск кратчайшего пути к администраторам домена:</p><p><figure><img src=images/1_short_path.png alt=1_short_path><figcaption><p style=text-align:center>Первый путь</p></figcaption></figure></p><p><figure><img src=images/2_short_path.png alt=2_short_path><figcaption><p style=text-align:center>Второй путь</p></figcaption></figure></p><p>С точки зрения BloodHound второй путь выглядит более предпочтительным, так как он короче чем первый. На практике наоборот, первый путь представляет последовательность вложенных групп, то есть фактически никаких усилий для доступа к группе &ldquo;Domain Admins&rdquo; предпринимать не надо. Во втором пути требуется выполнения дополнительных условий, в частности &ldquo;User B&rdquo; после входа по RDP должен каким-то образом повысить свои права на &ldquo;CALABDC.HACKERS.LAB&rdquo;.</p><p>Приведенный пример хорошо иллюстрирует следующую мысль: &ldquo;разные ребра графа обладают разными характеристиками, которые никак не учитываются в BloodHound&rdquo;.</p><p>В качестве характеристик можно рассматривать следующие параметры:</p><ul><li>сложность перехода по ребру с точки зрения реализации на практике</li><li>скрытность эксплуатации</li></ul><p>Определившись с категориями характеристик, специалист должен вручную задать весовые параметры для каждого из возможных ребер графа. По итогу получается подобная таблица:</p><p><img src=images/table.png alt=table></p><p>Чем хуже проявляется свойство, тем выше вес. Сразу отмечу, что задача распределения весов сводится к экспертной оценке специалиста.</p><p>После распределения весов для дальнейшей работы необходимо составить соответствующие запросы. По умолчанию BloodHound не учитывает вес при поиске кратчайших путей. Для использования в Neo4j алгоритмов поиска наименьших расстояний во взвешенном графе следует подключить библиотеку <a href=https://neo4j.com/docs/graph-data-science/current/algorithms/dijkstra-single-source/>Graph Data Science</a>.</p><p>Более подробно вопрос внедрения весовых коэффициентов описывается в статье <a href=https://riccardoancarani.github.io/2019-11-08-not-all-paths-are-equal/>Not All Paths are Created Equal</a>.</p><h3 id=многоуровневая-архитектура-безопасности>Многоуровневая архитектура безопасности<a hidden class=anchor aria-hidden=true href=#многоуровневая-архитектура-безопасности>#</a></h3><p>Более подробно ознакомиться с понятием многоуровневой архитектуры безопасности можно по следующим ссылкам:</p><ul><li><a href=https://music.yandex.ru/album/21374924/track/110607787>Запись</a> трансляции в формате тестового собеседования</li><li><a href=https://bbs.kanxue.com/thread-258288.htm>Mitigate Credential theft with Administrative Tier Model</a> - копия статьи из официальной документации Microsoft</li></ul><p>Применительно к BloodHound существует инструмент <a href=https://github.com/improsec/ImproHound>ImproHound</a>, с помощью которого возможно распределить все объекты домена между тремя уровнями.</p><p><img src=images/improhound_tiers.PNG alt=improhound_tiers>
По окончанию распределения инструмент осуществляет поиск путей между объектами низлежащих уровней до объектов более высокого уровня и представляет результат в виде csv таблицы.</p><p><img src=images/improhound_result.PNG alt=improhound_result></p><p>В качестве альтернативного решения, но уже без привязки к BloodHound, можно рассмотреть программу <a href=https://www.purple-knight.com/forest-druid/>Forest Druid</a>.</p><p><img src=images/forest.png alt=forest></p><h3 id=объекты-первоначального-доступа>Объекты первоначального доступа<a hidden class=anchor aria-hidden=true href=#объекты-первоначального-доступа>#</a></h3><p>При построении векторов атак важно определить объекты первоначального доступа. В дальнейшем поиск векторов осуществляется в предположении о наличие контроля над указанными объектами. В BloodHound эквивалентом объекта первоначального доступа можно считать метку &ldquo;owned&rdquo;.</p><p>Ранее уже были кратко затронуты некоторые примеры объектов первоначального доступа. Для большего порядка и централизации информации приведу расширенный перечень объектов, которые могут рассматриваться в качестве отправных точек:</p><ul><li>Учетные записи, подверженные атаке asreproasting или kerberoasting (в ряде случаев)</li><li>Учетные записи с паролями в описании или в материалах общедоступных утечек информации, а также сетевых папок</li><li>Учетные записи, подверженные атаке методом распыления пароля</li><li>Машинные учетные записи с предустановленными паролями (<a href=https://www.trustedsec.com/blog/diving-into-pre-created-computer-accounts/>Diving into Pre-Created Computer Accounts</a>, <a href=https://web.archive.org/web/20230213014909/https://www.optiv.com/insights/source-zero/blog/diving-deeper-pre-created-computer-accounts>Diving Deeper Into Pre-created Computer Accounts</a>, <a href=https://github.com/garrettfoster13/pre2k>pre2k</a>)</li><li>Системы, обладающие критическими уязвимостями</li><li>Учетные записи, позволяющие атакующему узнать NTLM v1 хеш от своих паролей</li><li>Системы, позволяющие анонимное подключение</li><li>Системы cо сторонними сервисами, позволяющими подобрать учетную запись и получить доступ (ssh, базы данных, vnc, web порталы и т.д.)</li><li>Пользовательские учетные записи имеющие словарные пароли и позволяющие атакующему узнать NTLM v2 от хеш своих паролей</li><li>Учетные записи, добытые при анализе защищенности Wi-Fi, основанного на WPA2 Enterprise</li><li>Учетные записи, добытые из принтеров</li><li>Системы, подверженные MouseJack</li></ul><h3 id=выгрузка-отчетов>Выгрузка отчетов<a hidden class=anchor aria-hidden=true href=#выгрузка-отчетов>#</a></h3><p>Некоторые утилиты используют, обрабатываемые в BloodHound данные, для выпуска статических отчетов. Познакомимся с двумя из них ближе.</p><h4 id=plumhound>PlumHound<a hidden class=anchor aria-hidden=true href=#plumhound>#</a></h4><p><a href=https://github.com/PlumHound/PlumHound>PlumHound</a> позволяет значительно упростить выпуск приложений к отчетам. Вот лишь некоторые из разделов, которые могут быть составлены с использованием указанной утилиты:</p><ul><li>перечень устаревших операционных систем с указанием DNS имен</li><li>перечень сессий пользователей</li><li>перечень учетных записей подверженных атаке Kerberoasting</li></ul><p><figure><img src=images/report_kerberoastable.png alt=report_kerberoastable><figcaption><p style=text-align:center>Пример страницы отчета PlumHound с информацией об учетных записях, подверженных атаке Kerberoasting</p></figcaption></figure></p><p>Важно отметить, что программа рассчитана на добавление произвольных пользовательских запросов. Таким образом PlumHound может быть использована для работы с новыми сущностями.</p><h4 id=анализ-парольной-политики>Анализ парольной политики<a hidden class=anchor aria-hidden=true href=#анализ-парольной-политики>#</a></h4><p>Целесообразность анализа выгрузки NT-хэшей пользователей домена довольно дискуссионный вопрос. Мнения специалистов на этот счет разнятся, но если проводить указанный анализ, то стоит обратить внимание на инструмент <a href=https://github.com/knavesec/Max>DPAT-max</a>.</p><p>В качестве вводных данных DPAT-max принимает potfile Hashcat, перечень учетных записей с NT-хэшами в формате pwdump, а также логин и пароль к BloodHound.</p><p>Итоговый отчет имеет следующие разделы:</p><p><figure><img src=images/dpat-htmloutput.png alt=dpat-htmloutput><figcaption><p style=text-align:center>Разделы отчета, составленного в DPAT-max</p></figcaption></figure></p><p>Более подробно ознакомиться с возможностями и устройством <a href=https://github.com/knavesec/Max>DPAT-max</a> можно в блоге автора указанной утилиты: <a href=https://whynotsecurity.com/blog/max3/>Max: BloodHound Domain Password Audit Tool</a>.</p><h3 id=визуализация>Визуализация<a hidden class=anchor aria-hidden=true href=#визуализация>#</a></h3><p>В следующих статьях рассказывается о дополнительных способах визуализации сведений, собранных для BloodHound, в том числе с использованием Jupyter Notebooks:</p><ul><li>&ldquo;Visualizing BloodHound Data with PowerBI&rdquo; <a href=https://posts.specterops.io/visualizing-bloodhound-data-with-powerbi-part-1-ba8ea4908422>часть 1</a>, <a href=https://posts.specterops.io/visualizing-bloodhound-data-with-powerbi-part-2-3e1c521fb7ae>часть 2</a></li><li><a href=https://riccardoancarani.github.io/2019-12-08-streamlining-bloodhound-analytics/>&ldquo;Streamlining BloodHound Analytics&rdquo;</a></li><li><a href=https://medium.com/threat-hunters-forge/jupyter-notebooks-for-bloodhound-analytics-and-alternative-visualizations-9543c2df576a>&ldquo;Jupyter Notebooks for BloodHound Analytics and Alternative Visualizations&rdquo;</a></li></ul><p><figure><img src=images/viz1.png alt=viz1><figcaption><p style=text-align:center>Пример созданной визуализации</p></figcaption></figure></p><h3 id=прочие-дополнения>Прочие дополнения<a hidden class=anchor aria-hidden=true href=#прочие-дополнения>#</a></h3><p>Также для общего развития приведу ряд утилит, которые не получилось отнести к какому-либо разделу ранее.</p><ul><li><a href=https://github.com/c3c/ADExplorerSnapshot.py>ADExplorerSnapshot.py</a> - конвертер снимка состояния домена, сделанного с помощью <a href=https://learn.microsoft.com/en-us/sysinternals/downloads/adexplorer>AD Explorer</a>, в JSON файл импортируемый BloodHound.</li><li><a href=https://github.com/blurbdust/ldd2bh>ldd2bh</a>- конвертер <a href=https://github.com/dirkjanm/ldapdomaindump>ldapdomaindump</a> в формат BloodHound, может пригодиться при релей атаках.</li><li><a href=https://github.com/fox-it/aclpwn.py>ACLPwn</a>- старый скрипт для автоматизации эксплуатации уязвимостей, выявленных в BloodHound</li><li><a href=https://github.com/knavesec/Max>Max</a>- утилита, включающая в себя ряд различных модулей, часть из которых не была рассмотрена ранее</li><li><a href=https://github.com/AssuranceMaladieSec/FoxTerrier>FoxTerrier</a></li><li><a href=https://github.com/fortalice/bofhound>BofHound</a></li></ul><h3 id=рекомендации-по-противодействию-bloodhound>Рекомендации по противодействию BloodHound<a hidden class=anchor aria-hidden=true href=#рекомендации-по-противодействию-bloodhound>#</a></h3><p>Чтобы затруднить атакующему проведение разведки с помощью BloodHound следует минимизировать сбор сведений, которые он может получить. Для этого можно:</p><ol><li>Ограничить доступ к списку сессий пользователей.</li><li>Запретить выгрузку перечня пользователей и групп из Active Directory по протоколу SAMRPC.</li><li>Отключить анонимные учетные записи</li><li>Исключить группу &ldquo;Authenticated Users&rdquo; из группы &ldquo;pre-Windows 2000 compatible access&rdquo; - <a href=https://www.semperis.com/blog/security-risks-pre-windows-2000-compatibility-windows-2022/>источник</a></li></ol><h2 id=промежуточный-итог-первой-части>Промежуточный итог первой части<a hidden class=anchor aria-hidden=true href=#промежуточный-итог-первой-части>#</a></h2><p>Из рассмотренного ранее материала следуют выводы:</p><ul><li>BloodHound можно обогатить множеством новых атрибутов, объектов и связей</li><li>&ldquo;обогащённый&rdquo; BloodHound можно дополнить новыми запросами</li><li>на основе запросов можно строить автоматизированные отчеты или интерактивные визуализации</li></ul><h2 id=часть-2-управление-векторами-атак>Часть 2. Управление векторами атак<a hidden class=anchor aria-hidden=true href=#часть-2-управление-векторами-атак>#</a></h2><p>Как было показано ранее, BloodHound содержит множество данных, на основе которых можно строить вероятные вектора компьютерных атак. Управление указанными векторами позволяет решать различные задачи.</p><p>С одной стороны защищающиеся могут проактивно определить наиболее вероятно атакуемые объекты домена с целью первоочередного устранения уязвимостей и недостатков в настройке указанных объектов.</p><p>С другой стороны атакующие могут выявить наиболее приоритетные цели для проведения компьютерных атак с целью дальнейшего продвижения или закрепления в домене.</p><p>Создатели BloodHound разумеется не оставили без внимания такое перспективное направления для развития своего инструмента и выпустили на его основе полноценный продукт <a href=https://bloodhoundenterprise.io/>BloodHound Enterprise</a>.</p><p><figure><img src=images/enterprise_example.webp alt=enterprise_example><figcaption><p style=text-align:center>Пример интерфейса BloodHound Enterprise</p></figcaption></figure></p><p>На <a href=https://bloodhoundenterprise.io/>официальном сайте</a> BloodHound присутствует множество маркетинговых лозунгов и это нормально для сайта платного продукта. Тем не менее кроме пестрых заголовков авторы BloodHound написали ряд статей на тему управления векторами атак:</p><ul><li><a href=https://posts.specterops.io/the-attack-path-management-manifesto-3a3b117f5e5>The Attack Path Management Manifesto</a></li><li><a href=https://bloodhoundenterprise.io/blog/2021/12/09/3-foundational-pillars-for-attack-path-management-pillar-1%e2%80%8a-%e2%80%8acontinuous-comprehensive-mapping/>3 Foundational Pillars for Attack Path Management: Pillar 1 — Continuous & Comprehensive Mapping</a></li><li><a href=https://medium.com/specter-ops-posts/3-foundational-pillars-for-attack-path-management-pillar-2-empirical-impact-assessment-17d81f9f4a8f>3 Foundational Pillars for Attack Path Management: Pillar 2 — Empirical Impact Assessment</a></li><li><a href=https://posts.specterops.io/attack-path-management-pillars-part-3-safe-ad-security-remediation-guidance-b9d3d8383cec>Attack Path Management Pillars: Part 3 —Practical AD Security Remediation Guidance</a></li></ul><p>Важно отметить, что BloodHound Enterprise обладает моделью распространения Software-as-a-Service, что в совокупности с отсутствием общедоступной пробной версии, не позволяет оценить этот продукт рядовому исследователю. Если у кого-то есть возможность предоставить доступ к интерфейсу <a href=https://bloodhoundenterprise.io/>BloodHound Enterprise</a>, то буду признателен.</p><p><figure><img src=images/enterprise_comparison.webp alt=enterprise_comparison><figcaption><p style=text-align:center>Таблица сравнения и различий двух версий BloodHound</p></figcaption></figure></p><p>Прежде чем выпустить платную версию, создатели BloodHound уже пробовали использовать его для управления векторами атак:</p><ul><li><a href=https://posts.specterops.io/introducing-the-adversary-resilience-methodology-part-one-e38e06ffd604>Introducing the Adversary Resilience Methodology — Part One</a></li><li><a href=https://posts.specterops.io/introducing-the-adversary-resilience-methodology-part-two-279a1ed7863d>Introducing the Adversary Resilience Methodology — Part Two</a></li></ul><p>Кроме того, некоторые исследователи смотрели на граф BloodHound с точки зрения анализа возможного распространения атакующего, в частности вредоносной программы вымогателя:</p><ul><li><a href=https://posts.specterops.io/bloodhound-versus-ransomware-a-defenders-guide-28147dedb73b>BloodHound versus Ransomware: A Defender’s Guide</a></li><li><a href=https://porterhau5.com/blog/extending-bloodhound-track-and-visualize-your-compromise/>Extending BloodHound: Track and Visualize Your Compromise</a></li><li><a href=https://zeronetworks.com/blog/adversary-resilience-via-least-privilege-networking-part-1/>Adversary Resilience Via Least Privilege Networking - Part 1</a></li><li><a href=https://zeronetworks.com/blog/adversary-resilience-via-least-privilege-networking-part-2/>Adversary Resilience Via Least Privilege Networking – Part 2</a></li><li><a href=https://github.com/zeronetworks/BloodHound-Tools/tree/main/Ransomulator>Ransomulator</a></li></ul><h2 id=значимые-объекты>Значимые объекты<a hidden class=anchor aria-hidden=true href=#значимые-объекты>#</a></h2><p>Одним из ключевых вопросов при исследовании векторов атак является выявление наиболее значимых объектов.</p><p>Для лучшего понимания приведу следующее нестрогое определение:
<strong>наиболее значимый объект</strong> - объект, захват которого вносит существенный вклад в дальнейшее развитие векторов атак.</p><p>Некоторые подходы к определению указанных объектов и оценки их значимости предпринимаются на практике, например в следующих инструментах:</p><ul><li><a href=https://github.com/idnahacks/GoodHound>GoodHound</a></li><li><a href=https://github.com/forestallio/kangal>Kangal</a> + статья: <a href=https://forestall.io/blog/en/combined-attack-paths-analysis-with-bloodhound-and-kangal-en/>Combined Attack Path Analysis with BloodHound and Kangal</a></li></ul><p><figure><img src=images/goodhound.gif alt=goodhound><figcaption><p style=text-align:center>Пример запуска GoodHound</p></figcaption></figure></p><p><figure><img src=images/kangal_1.PNG alt=kangal_1><figcaption><p style=text-align:center>Пример до преобразования в Kangal</p></figcaption></figure></p><p><figure><img src=images/kangal_2.PNG alt=kangal_2><figcaption><p style=text-align:center>Пример после преобразования в Kangal</p></figcaption></figure></p><p>Также на момент написания настоящего материала был опубликован цикл статей:</p><ul><li><a href=https://falconforce.nl/bloodhound-calculating-ad-metrics-0x01/>BloodHound — Calculating AD metrics 0x01</a></li><li><a href=https://falconforce.nl/bloodhound-calculating-ad-metrics-0x02/>BloodHound — Calculating AD metrics 0x02</a></li></ul><p>Не будем заострять внимание на разборе каждого из представленных инструментов. Отмечу, что предложенные в них подходы к оценкам имеют место, но видятся мне относительно грубыми. На этом моменте у меня появилось желание изобрести свой велосипед.</p><h3 id=предлагаемый-подход-к-оценке-значимости>Предлагаемый подход к оценке значимости<a hidden class=anchor aria-hidden=true href=#предлагаемый-подход-к-оценке-значимости>#</a></h3><p>Для начала более формализовано опишу задачу. Имеется взвешенный мультиорграф, отображающий вероятные вектора атак в домене Active Directory, построенные от объектов первоначального доступа до заданной особо привилегированной цели, например группы &ldquo;Domain Admins&rdquo;. Требуется определить меру значимости каждого, входящего в указанный мультиорграф элемента с точки зрения атакующей или защищающей стороны.</p><p>На практике построить наиболее полный мультиорграф, выделить объекты первоначального доступа, а также распределить веса ребер возможно с помощью способов, рассмотренных ранее в первой части.</p><p>В ходе поиска решения, кроме Kangal и GoodHound, была также рассмотрена целесообразность использования встроенных в neo4j алгоритмов <a href=https://neo4j.com/docs/graph-data-science/current/algorithms/centrality/>центральности</a>. Учитывая, что настоящий материал не претендует на публикацию в журнале &ldquo;Science&rdquo;, без строгих сравнений и разных выкладок просто отмечу, что личная чуйка говорила, что можно найти нечто лучше.</p><p>В итоге самой интересной и перспективной мне показалась идея, основанная на электрических цепях. Про нечто подобное можно почитать в диссертации <a href=https://petrsu.ru/files/user/beb228124c2cc2305a9ec67be48c9b98/diss_cinguev.pdf>&ldquo;Математические модели ранжирования вершин в графах коммуникационных сетей&rdquo;</a>.</p><p>Чуть более подробнее расскажу о предлагаемой идее. Для иллюстрации рассмотрим следующий надуманный пример:</p><p><img src=images/path_example.png alt=path_example></p><p>Учетная запись, подверженная атаке <a href=/posts/kerberos_general_attacks/#as-rep-roasting>AS-REP roasting</a>, выступает в качестве точки первоначального доступа, а DC - особо привилегированная цель.</p><p>Для примера составим таблицу с весами:</p><table><thead><tr><th>Название</th><th>Вес</th></tr></thead><tbody><tr><td>&ldquo;может зайти по RDP&rdquo;</td><td>40</td></tr><tr><td>&ldquo;является админом&rdquo;</td><td>5</td></tr><tr><td>&ldquo;входит&rdquo;</td><td>1</td></tr><tr><td>&ldquo;имеет сессию&rdquo;</td><td>50</td></tr><tr><td>&ldquo;DCSync&rdquo;</td><td>5</td></tr></tbody></table><p>Далее полученный граф преобразовывается в электрическую схему по следующим правилам:</p><ol><li>Точки первоначального доступа преобразуются в источники ЭДС (тока). Также в качестве улучшения имеет смысл также составить отдельную таблицу для различных классов объектов первоначального доступа, в которой в зависимости от вероятности захвата указанных объектов ставить в соответствие различные напряжения.</li><li>Ребро перехода преобразуются в резистор, последовательно соединенный с диодом. Величина сопротивления прямо пропорциональна весу ребра. Диод необходим для учета свойства ориентированности графа.</li><li>Особо привилегированная цель преобразуется в заземление.</li></ol><p>В результате получившуюся долю величины тока, проходящего через выбранный объект, от общего количества поданной величины тока, можно считать <strong>мерой значимости</strong> указанного объекта.</p><p>Тем, кто знаком с правилами Кирхгофа, преимущества предлагаемого подхода должны быть очевидны.</p><p>C помощью программы <a href=https://www.multisim.com>Multisim</a> была смоделирована электрическая схема с учетом предложенных преобразований:</p><p><img src=images/current_scheme.png alt=current_scheme></p><p>В рассматриваемом случае, мера значимости верхних объектов составляет 56.5 единиц, а нижних 43.5. Таким образом, с точки зрения атакующего верхний путь на 13 процентов предпочтительнее нижнего. Разумеется это всего лишь иллюстрирующий пример и на практике схемы получаются куда сложнее.</p><p>Автоматизировать построение и расчёт электрических схем на языке Python можно с помощью модуля <a href=https://pypi.org/project/ltspice/>ltspice</a>.</p><p>Немного лирики. Ток стремится идти по пути наименьшего сопротивления. Уместна аналогия с водой которая стекает со склона с разными углами наклона. Природа сама строит наиболее подходящий маршрут, а если по нему и так уже течет предостаточно, то вода все равно найдет другой путь.</p><p><img src=images/waterfall.jpg alt=waterfall></p><p>Итоговый граф, содержащий посчитанные оценки значимости, можно выгрузить в общепринятом формате (graphml) и визуализировать с помощью различных сторонних инструментов. В этом плане хорошо себя показал <a href=https://www.yworks.com/products/yed/download>yEd</a>, в котором, в частности, нетрудно установить соотношение между толщиной линии и количеством тока, проходящего по эквивалентной схеме.</p><p>Для примера тестовый граф, приведенный ниже:</p><p><img src=images/example_paths.PNG alt=example_paths></p><p>Преобразуется в следующую интерактивную визуализацию:</p><p><img src=images/yed_example.png alt=yed_example></p><h2 id=заключение>Заключение<a hidden class=anchor aria-hidden=true href=#заключение>#</a></h2><p>Представленный материал не содержит готового решения, а скорее включает множество полезных ссылок для самостоятельного изучения и вдохновения. Тем не менее ряд из рассмотренных идей могут быть полезны специалистам, желающим усовершенствовать свои подходы к анализу небезопасных конфигураций Active Directory.</p><p>Также в завершении был предложен и кратко описан свой собственный алгоритм оценки значимости объектов Active Directory с точки зрения атакующих и защищающих.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ardent101.github.io/tags/active-directory/>Active Directory</a></li><li><a href=https://ardent101.github.io/tags/pentest/>Pentest</a></li><li><a href=https://ardent101.github.io/tags/%D1%82%D0%B5%D0%BE%D1%80%D0%B8%D1%8F/>Теория</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Немного про построение векторов атак on twitter" href="https://twitter.com/intent/tweet/?text=%d0%9d%d0%b5%d0%bc%d0%bd%d0%be%d0%b3%d0%be%20%d0%bf%d1%80%d0%be%20%d0%bf%d0%be%d1%81%d1%82%d1%80%d0%be%d0%b5%d0%bd%d0%b8%d0%b5%20%d0%b2%d0%b5%d0%ba%d1%82%d0%be%d1%80%d0%be%d0%b2%20%d0%b0%d1%82%d0%b0%d0%ba&url=https%3a%2f%2fardent101.github.io%2fposts%2fbh_improvement%2f&hashtags=ActiveDirectory%2cPentest%2c%d0%a2%d0%b5%d0%be%d1%80%d0%b8%d1%8f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Немного про построение векторов атак on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fardent101.github.io%2fposts%2fbh_improvement%2f&title=%d0%9d%d0%b5%d0%bc%d0%bd%d0%be%d0%b3%d0%be%20%d0%bf%d1%80%d0%be%20%d0%bf%d0%be%d1%81%d1%82%d1%80%d0%be%d0%b5%d0%bd%d0%b8%d0%b5%20%d0%b2%d0%b5%d0%ba%d1%82%d0%be%d1%80%d0%be%d0%b2%20%d0%b0%d1%82%d0%b0%d0%ba&summary=%d0%9d%d0%b5%d0%bc%d0%bd%d0%be%d0%b3%d0%be%20%d0%bf%d1%80%d0%be%20%d0%bf%d0%be%d1%81%d1%82%d1%80%d0%be%d0%b5%d0%bd%d0%b8%d0%b5%20%d0%b2%d0%b5%d0%ba%d1%82%d0%be%d1%80%d0%be%d0%b2%20%d0%b0%d1%82%d0%b0%d0%ba&source=https%3a%2f%2fardent101.github.io%2fposts%2fbh_improvement%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Немного про построение векторов атак on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fardent101.github.io%2fposts%2fbh_improvement%2f&title=%d0%9d%d0%b5%d0%bc%d0%bd%d0%be%d0%b3%d0%be%20%d0%bf%d1%80%d0%be%20%d0%bf%d0%be%d1%81%d1%82%d1%80%d0%be%d0%b5%d0%bd%d0%b8%d0%b5%20%d0%b2%d0%b5%d0%ba%d1%82%d0%be%d1%80%d0%be%d0%b2%20%d0%b0%d1%82%d0%b0%d0%ba"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Немного про построение векторов атак on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fardent101.github.io%2fposts%2fbh_improvement%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Немного про построение векторов атак on whatsapp" href="https://api.whatsapp.com/send?text=%d0%9d%d0%b5%d0%bc%d0%bd%d0%be%d0%b3%d0%be%20%d0%bf%d1%80%d0%be%20%d0%bf%d0%be%d1%81%d1%82%d1%80%d0%be%d0%b5%d0%bd%d0%b8%d0%b5%20%d0%b2%d0%b5%d0%ba%d1%82%d0%be%d1%80%d0%be%d0%b2%20%d0%b0%d1%82%d0%b0%d0%ba%20-%20https%3a%2f%2fardent101.github.io%2fposts%2fbh_improvement%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Немного про построение векторов атак on telegram" href="https://telegram.me/share/url?text=%d0%9d%d0%b5%d0%bc%d0%bd%d0%be%d0%b3%d0%be%20%d0%bf%d1%80%d0%be%20%d0%bf%d0%be%d1%81%d1%82%d1%80%d0%be%d0%b5%d0%bd%d0%b8%d0%b5%20%d0%b2%d0%b5%d0%ba%d1%82%d0%be%d1%80%d0%be%d0%b2%20%d0%b0%d1%82%d0%b0%d0%ba&url=https%3a%2f%2fardent101.github.io%2fposts%2fbh_improvement%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://ardent101.github.io/>Ardent101</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="копировать";function s(){e.innerText="скопировано!",setTimeout(()=>{e.innerText="копировать"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>